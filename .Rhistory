}) %>% list_rbind() %>%
select(all_of(c("Sample",
paste0(rep(clones, each=3),
"_", c("I", "II", "III")
))
))
input = sapply(1:length(Analysis_modes), simplify = F, \(i) {
read_delim(inFiles[i])[-1,]
}) %>% list_rbind() %>%
select(all_of(c("Sample",
paste0(rep(clones, each=3),
"_", c("I", "II", "III")
))
)) %>%
rename(Metabolite = Sample) %>%
filter(Metabolite %in% featuresKept_metaboanalyst)
View(input)
analytes_detected <-
sapply(clones, simplify = T, \(x) {
data_clone <-
input %>%
select(
all_of(paste0(x, "_", c("I", "II", "III")))
)
apply(data_clone[-1], 2, \(y) as.numeric(y) %>% as.logical) %>%
rowSums
}) %>%
mutate(Metabolite = input$Metabolite)
analytes_detected <-
sapply(clones, simplify = T, \(x) {
data_clone <-
input %>%
select(
all_of(paste0(x, "_", c("I", "II", "III")))
)
apply(data_clone[-1], 2, \(y) as.numeric(y) %>% as.logical) %>%
rowSums
}) %>% as_tibble() %>%
mutate(Metabolite = input$Metabolite)
View(analytes_detected)
analytes_detected <-
sapply(clones, simplify = T, \(x) {
data_clone <-
input %>%
select(
all_of(paste0(x, "_", c("I", "II", "III")))
)
apply(data_clone, 2, \(y) as.numeric(y) %>% as.logical) %>%
rowSums
}) %>% as_tibble() %>%
mutate(Metabolite = input$Metabolite)
apply(analytes_detected[1:4,], 2, \(x) >=2)
apply(analytes_detected[1:4,], 2, \(x) x >= 2)
apply(analytes_detected[1:4,], 2, \(x) length(x >= 2))
apply(analytes_detected[1:4,], 2, \(x) length(which(x >= 2)))
analytes_detected[1:4,]
apply(analytes_detected[,1:4], 2, \(x) length(which(x >= 2)))
apply(analytes_detected[,1:4], 2, \(x) length(which(x >= 2)))
apply(analytes_detected[,1:4], 2, \(x) length(which(x >= 2)))
apply(analytes_detected[,1:4], 2, \(x) length(which(x ==3)))
apply(analytes_detected[,1:4], 2, \(x) length(which(x >= 2)))
apply(analytes_detected[,1:4], 2, \(x) length(which(x ==3)))
apply(data_clone, 2, \(y) as.numeric(y) %>% as.logical) %>%
rowSums
analytes_detected <-
sapply(clones, simplify = T, \(x) {
data_clone <-
input %>%
select(
all_of(paste0(x, "_", c("I", "II", "III")))
)
apply(data_clone, 2, \(y) as.numeric(y) %>% as.logical) %>%
rowSums
}) %>% as_tibble()
analytes_detected_2orMore <-
apply(analytes_detected, 2, \(x) which(x >= 2)) %>%
as_tibble() %>%
mutate(Metabolite = input$Metabolite)
analytes_detected_2orMore <-
sapply(names(analytes_detected), \(x) which(x >= 2)) %>%
as_tibble() %>%
mutate(Metabolite = input$Metabolite)
analytes_detected_2orMore <-
sapply(names(analytes_detected), \(x) {
which(analytes_detected[[x]] >= 2)
}) %>%
as_tibble() %>%
mutate(Metabolite = input$Metabolite)
analytes_detected_2orMore <-
sapply(names(analytes_detected), \(x) {
analytes_detected[[x]] >= 2
}) %>%
as_tibble() %>%
mutate(Metabolite = input$Metabolite)
analytes_detected_2orMore <-
apply(analytes_detected, 2, \(x) {
x >= 2
}) %>%
as_tibble() %>%
mutate(Metabolite = input$Metabolite)
analytes_detected_all3 <-
apply(analytes_detected, 2, \(x) {
x == 3
}) %>%
as_tibble() %>%
mutate(Metabolite = input$Metabolite)
analytes_detected_all3 <-
apply(analytes_detected, 2, \(x) {
x == 3
}) %>%
as.data.frame(row.names = input$Metabolite) %>%
filter(rowSums(.) != 0) %>%
mutate(Metabolite = row.names(.))
analytes_detected_2orMore <-
apply(analytes_detected, 2, \(x) {
x >= 2
})  %>%
as.data.frame(row.names = input$Metabolite) %>%
filter(rowSums(.) != 0) %>%
mutate(Metabolite = row.names(.))
analytes_detected_2orMore <-
apply(analytes_detected, 2, \(x) {
x >= 2
})  %>%
as.data.frame(row.names = input$Metabolite) %>%
filter(rowSums(.) != 0) %>%
mutate(Metabolite = row.names(.)) %>%
separate(col = Metabolite, into = c("RT", "Mz"),
sep = "/", convert = T)
analytes_detected_all3 <-
apply(analytes_detected, 2, \(x) {
x == 3
}) %>%
as.data.frame(row.names = input$Metabolite) %>%
filter(rowSums(.) != 0) %>%
mutate(Metabolite = row.names(.)) %>%
separate(col = Metabolite, into = c("RT", "Mz"),
sep = "/", convert = T)
Annotation <-
read_delim("Results/Annotation_clean_names.txt") %>%
right_join(analytes_detected,
by = join_by("Average Rt(min)" == "RT",
"Average Mz" == "Mz"))
Annotation_2orMore <-
read_delim("Results/Annotation_clean_names.txt") %>%
right_join(analytes_detected_2orMore,
by = join_by("Average Rt(min)" == "RT",
"Average Mz" == "Mz"))
Annotation_all3 <-
read_delim("Results/Annotation_clean_names.txt") %>%
right_join(analytes_detected_all3,
by = join_by("Average Rt(min)" == "RT",
"Average Mz" == "Mz"))
analytes_detected_2orMore <-
apply(analytes_detected, 2, \(x) {
x >= 2
})  %>%
as.data.frame(row.names = input$Metabolite) %>%
filter(rowSums(.) != 0) %>%
mutate(Metabolite = row.names(.)) %>%
separate(col = Metabolite, into = c("RT", "Mz"),
sep = "/", convert = T)
Annotation_2orMore <-
read_delim("Results/Annotation_clean_names.txt") %>%
right_join(analytes_detected_2orMore,
by = join_by("Average Rt(min)" == "RT",
"Average Mz" == "Mz"))
annotated_detected_2orMore <- Annotation_2orMore %>%
filter(Clean_name != "Unknown" &
!grepl("w/o MS2", Clean_name))
analytes_detected_all3 <-
apply(analytes_detected, 2, \(x) {
x == 3
}) %>%
as.data.frame(row.names = input$Metabolite) %>%
filter(rowSums(.) != 0) %>%
mutate(Metabolite = row.names(.)) %>%
separate(col = Metabolite, into = c("RT", "Mz"),
sep = "/", convert = T)
Annotation_all3 <-
read_delim("Results/Annotation_clean_names.txt") %>%
right_join(analytes_detected_all3,
by = join_by("Average Rt(min)" == "RT",
"Average Mz" == "Mz"))
Annotation_all3 <-
read_delim("Results/Annotation_clean_names.txt") %>%
right_join(analytes_detected_all3,
by = join_by("Average Rt(min)" == "RT",
"Average Mz" == "Mz"))
venn(analytes_detected_all[, clones], main="Detected",
ilabels = "counts",
ellipse = T, box = F,
zcolor = "style",
par = T)
analytes_detected_all[, clones]
venn(analytes_detected_2orMore[, clones], main="Detected",
ilabels = "counts",
ellipse = T, box = F,
zcolor = "style",
par = T)
venn(annotated_detected_2orMore[, clones], main="Annotated",
ilabels = "counts",
ellipse = T, box = F,
zcolor = "style",
par = T)
annotated_detected_2orMore %>%
filter(!pPTGE30)
annotated_detected_2orMore %>%
filter(!pPTGE30) %>%
select(Clean_name, INCHIKEY, all_of(clones))
analytes_detected_all3 <-
apply(analytes_detected, 2, \(x) {
x == 3
}) %>%
as.data.frame(row.names = input$Metabolite) %>%
filter(rowSums(.) != 0) %>%
mutate(Metabolite = row.names(.)) %>%
separate(col = Metabolite, into = c("RT", "Mz"),
sep = "/", convert = T)
Annotation_all3 <-
read_delim("Results/Annotation_clean_names.txt") %>%
right_join(analytes_detected_all3,
by = join_by("Average Rt(min)" == "RT",
"Average Mz" == "Mz"))
Annotation_all3 <-
read_delim("Results/Annotation_clean_names.txt") %>%
right_join(analytes_detected_all3,
by = join_by("Average Rt(min)" == "RT",
"Average Mz" == "Mz"))
analytes_detected_all3 <-
apply(analytes_detected, 2, \(x) {
x == 3
}) %>%
as.data.frame(row.names = input$Metabolite) %>%
filter(rowSums(.) != 0) %>%
mutate(Metabolite = row.names(.)) %>%
separate(col = Metabolite, into = c("RT", "Mz"),
sep = "/", convert = T)
annotated_detected_all3 <-
read_delim("Results/Annotation_clean_names.txt") %>%
right_join(analytes_detected_all3,
by = join_by("Average Rt(min)" == "RT",
"Average Mz" == "Mz"))
Annotation_all3 <-
read_delim("Results/Annotation_clean_names.txt") %>%
right_join(analytes_detected_all3,
by = join_by("Average Rt(min)" == "RT",
"Average Mz" == "Mz"))
venn(analytes_detected_all3[, clones], main="Detected",
ilabels = "counts",
ellipse = T, box = F,
zcolor = "style",
par = T)
venn(annotated_detected_all[, clones], main="Annotated",
ilabels = "counts",
ellipse = T, box = F,
zcolor = "style",
par = T)
venn(annotated_detected_all3[, clones], main="Annotated",
ilabels = "counts",
ellipse = T, box = F,
zcolor = "style",
par = T)
venn(annotated_detected_all3[, clones], main="Annotated",
ilabels = "counts",
ellipse = T, box = F,
zcolor = "style",
par = T)
venn(analytes_detected_all3[, clones], main="Detected",
ilabels = "counts",
ellipse = T, box = F,
zcolor = "style",
par = T)
venn(annotated_detected_all3[, clones], main="Annotated",
ilabels = "counts",
ellipse = T, box = F,
zcolor = "style",
par = T)
Annotation_all3 <-
read_delim("Results/Annotation_clean_names.txt") %>%
filter(Clean_name != "Unknown" &
!grepl("w/o MS2", Clean_name))
Annotation_all3 <-
read_delim("Results/Annotation_clean_names.txt") %>%
right_join(analytes_detected_all3,
by = join_by("Average Rt(min)" == "RT",
"Average Mz" == "Mz"))
annotated_detected_all3 <-
read_delim("Results/Annotation_clean_names.txt") %>%
filter(Clean_name != "Unknown" &
!grepl("w/o MS2", Clean_name))
Annotation_all3 <-
read_delim("Results/Annotation_clean_names.txt") %>%
right_join(analytes_detected_all3,
by = join_by("Average Rt(min)" == "RT",
"Average Mz" == "Mz"))
annotated_detected_all3 <-
Annotation_all3 %>%
filter(Clean_name != "Unknown" &
!grepl("w/o MS2", Clean_name))
venn(annotated_detected_all3[, clones], main="Annotated",
ilabels = "counts",
ellipse = T, box = F,
zcolor = "style",
par = T)
annotated_detected_all3 %>%
filter(!pPTGE30) %>%
select(Clean_name, INCHIKEY, all_of(clones))
#### table ####
annotated_detected_2orMore %>%
filter(!pPTGE30) %>%
select(Clean_name, INCHIKEY, all_of(clones))
View(analytes_detected)
View(annotated_detected_all3)
View(input)
47/5
par(cex=1, font=1);
pdf('plots/Venn_filteredMetaboanalyst_2orMore.pdf',
width=8, height=8, pointsize = 30)
venn(analytes_detected_2orMore[, clones], main="Detected",
ilabels = "counts",
ellipse = T, box = F,
zcolor = "style",
par = T)
venn(annotated_detected_2orMore[, clones], main="Annotated",
ilabels = "counts",
ellipse = T, box = F,
zcolor = "style",
par = T)
dev.off()
##### All three reps #####
pdf('plots/Venn_filteredMetaboanalyst_2orMore.pdf',
width=8, height=8, pointsize = 30)
venn(analytes_detected_all3[, clones], main="Detected",
ilabels = "counts",
ellipse = T, box = F,
zcolor = "style",
par = T)
venn(annotated_detected_all3[, clones], main="Annotated",
ilabels = "counts",
ellipse = T, box = F,
zcolor = "style",
par = T)
dev.off()
#### table ####
annotated_detected_2orMore %>%
filter(!pPTGE30) %>%
select(Clean_name, INCHIKEY, all_of(clones))
annotated_detected_all3 %>%
filter(!pPTGE30) %>%
select(Clean_name, INCHIKEY, all_of(clones))
##### All three reps #####
pdf('plots/Venn_filteredMetaboanalyst_2orMore.pdf',
width=8, height=8, pointsize = 30)
venn(analytes_detected_all3[, clones], main="Detected",
ilabels = "counts",
ellipse = T, box = F,
zcolor = "style",
par = T)
venn(annotated_detected_all3[, clones], main="Annotated",
ilabels = "counts",
ellipse = T, box = F,
zcolor = "style",
par = T)
dev.off()
dev.off()
# Mets present in each clone
library(tidyverse)
library(MetaboAnalystR)
library(venn)
clones <- c(paste0("AC9.", 1:3), "pPTGE30")
Analysis_modes = c("HILIC_Positive",
"RP_Positive",
"RP_Negative")
inFiles <- paste0("Inputs/CleanUp_LCMSMS_", Analysis_modes, "_rawHeight.txt")
outFiles <- paste0("Results/Analytes_detected_by_clone_", Analysis_modes, ".txt")
mSetData <- paste0("Results/", Analysis_modes, "_mSet.RData")
featuresKept_metaboanalyst <- sapply(mSetData, \(x) {
load(x)
mSet[["dataSet"]][["filt"]] %>% colnames
})%>% unlist %>% unname %>% c
input = sapply(1:length(Analysis_modes), simplify = F, \(i) {
read_delim(inFiles[i])[-1,]
}) %>% list_rbind() %>%
select(all_of(c("Sample",
paste0(rep(clones, each=3),
"_", c("I", "II", "III")
))
)) %>%
rename(Metabolite = Sample) %>%
filter(Metabolite %in% featuresKept_metaboanalyst)
analytes_detected <-
sapply(clones, simplify = T, \(x) {
data_clone <-
input %>%
select(
all_of(paste0(x, "_", c("I", "II", "III")))
)
apply(data_clone, 2, \(y) as.numeric(y) %>% as.logical) %>%
rowSums
}) %>% as_tibble()
#### Detected in at least 2 reps ####
analytes_detected_2orMore <-
apply(analytes_detected, 2, \(x) {
x >= 2
})  %>%
as.data.frame(row.names = input$Metabolite) %>%
filter(rowSums(.) != 0) %>%
mutate(Metabolite = row.names(.)) %>%
separate(col = Metabolite, into = c("RT", "Mz"),
sep = "/", convert = T)
Annotation_2orMore <-
read_delim("Results/Annotation_clean_names.txt") %>%
right_join(analytes_detected_2orMore,
by = join_by("Average Rt(min)" == "RT",
"Average Mz" == "Mz"))
annotated_detected_2orMore <- Annotation_2orMore %>%
filter(Clean_name != "Unknown" &
!grepl("w/o MS2", Clean_name))
#### Detected in all reps ####
analytes_detected_all3 <-
apply(analytes_detected, 2, \(x) {
x == 3
}) %>%
as.data.frame(row.names = input$Metabolite) %>%
filter(rowSums(.) != 0) %>%
mutate(Metabolite = row.names(.)) %>%
separate(col = Metabolite, into = c("RT", "Mz"),
sep = "/", convert = T)
Annotation_all3 <-
read_delim("Results/Annotation_clean_names.txt") %>%
right_join(analytes_detected_all3,
by = join_by("Average Rt(min)" == "RT",
"Average Mz" == "Mz"))
annotated_detected_all3 <-
Annotation_all3 %>%
filter(Clean_name != "Unknown" &
!grepl("w/o MS2", Clean_name))
#### Venn plots ####
##### 2 or more #####
par(cex=1, font=1);
pdf('plots/Venn_filteredMetaboanalyst_2orMore.pdf',
width=8, height=8, pointsize = 30)
venn(analytes_detected_2orMore[, clones], main="Detected",
ilabels = "counts",
ellipse = T, box = F,
zcolor = "style",
par = T)
venn(annotated_detected_2orMore[, clones], main="Annotated",
ilabels = "counts",
ellipse = T, box = F,
zcolor = "style",
par = T)
dev.off()
##### All three reps #####
pdf('plots/Venn_filteredMetaboanalyst_2orMore.pdf',
width=8, height=8, pointsize = 30)
venn(analytes_detected_all3[, clones], main="Detected",
ilabels = "counts",
ellipse = T, box = F,
zcolor = "style",
par = T)
venn(annotated_detected_all3[, clones], main="Annotated",
ilabels = "counts",
ellipse = T, box = F,
zcolor = "style",
par = T)
dev.off()
#### table ####
annotated_detected_2orMore %>%
filter(!pPTGE30) %>%
select(Clean_name, INCHIKEY, all_of(clones))
annotated_detected_all3 %>%
filter(!pPTGE30) %>%
select(Clean_name, INCHIKEY, all_of(clones))
t.test(x = c(9.2, 9.4, 9.6), y = c(70, 72, 74))
p.adjust(0.0003007, n=13407)
p.adjust(0.0003007, n=6)
pdf('plots/Venn_filteredMetaboanalyst_2orMore.pdf',
width=8, height=8, pointsize = 30)
venn(analytes_detected_2orMore[, clones], main="Detected",
ilabels = "counts",
ellipse = T, box = F,
zcolor = "style",
par = T)
venn(annotated_detected_2orMore[, clones], main="Annotated",
ilabels = "counts",
ellipse = T, box = F,
zcolor = "style",
par = T)
dev.off()
##### All three reps #####
pdf('plots/Venn_filteredMetaboanalyst_all3.pdf',
width=8, height=8, pointsize = 30)
venn(analytes_detected_all3[, clones], main="Detected",
ilabels = "counts",
ellipse = T, box = F,
zcolor = "style",
par = T)
venn(annotated_detected_all3[, clones], main="Annotated",
ilabels = "counts",
ellipse = T, box = F,
zcolor = "style",
par = T)
dev.off()
annotated_detected_all3 %>%
filter(!pPTGE30) %>%
select(Clean_name, INCHIKEY, all_of(clones))
#### table ####
annotated_detected_2orMore %>%
filter(!pPTGE30) %>%
select(Clean_name, INCHIKEY, all_of(clones))
