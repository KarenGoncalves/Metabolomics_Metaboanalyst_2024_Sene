select(all_of(clones))
pdf('plots/Venn_filteredMetaboanalyst_detected3reps.pdf',
width=8, height=8, pointsize = 30)
venn(venn_detected,
ilabels = "counts",
ellipse = T, box = F,
zcolor = "style",
par = T)
dev.off()
venn_annotated_detected <-
annotated_detected %>%
select(all_of(clones))
pdf('plots/Venn_filteredMetaboanalyst_annotatedDetected3reps.pdf',
width=8, height=8, pointsize = 30)
venn(venn_annotated_detected,
ilabels = "counts",
ellipse = T, box = F,
zcolor = "style",
par = T)
dev.off()
annotated_detected %>%
filter(!E30) %>%
select(Clean_name, INCHIKEY, all_of(clones)) %>%
write_delim(file = "Results/Annotated_notInE303reps.txt",
delim="\t")
# Mets present in each clone
library(tidyverse)
library(MetaboAnalystR)
library(venn)
clones <- c(paste0("AC9.", 1:3), "E30")
Analysis_modes = c("HILIC_Positive",
"RP_Positive",
"RP_Negative")
inFiles <- paste0("Inputs/CleanUp_LCMSMS_", Analysis_modes, "_rawHeight.txt")
outFiles <- paste0("Results/Analytes_detected_by_clone_", Analysis_modes, ".txt")
mSetData <- paste0("Results/", Analysis_modes, "_mSet.RData")
analytes_detected <- sapply(1:length(Analysis_modes), simplify = F, \(i) {
file = inFiles[i]
output = outFiles[i]
load(mSetData[i])
featuresKept_metaboanalyst <-
mSet[["dataSet"]][["filt"]] %>% colnames
input = read_delim(file)
metadata = data.frame(Clone = input[1, -1] %>% unlist %>% unname ,
Replicate = names(input)[-1]) %>%
filter(Clone != "QC")
input_logical =
as.data.frame(input[-1,],
row.names = input[-1,1] %>% c)[-1] %>%
apply(MARGIN=2, \(x) as.numeric(x) %>% as.logical )
rownames(input_logical) = input$Sample[-1]
groups = unique(metadata$Clone)
sapply(groups, \(x) {
rowSums(input_logical[featuresKept_metaboanalyst,
metadata$Replicate[metadata$Clone == x]]) == 3
}) %>% as.data.frame
}) %>% list_rbind() %>%
filter(rowSums(.) != 0) %>%
mutate(MetID = row.names(.)) %>%
separate(col = MetID, into = c("RT", "Mz"), sep = "/", convert = T)
Annotation <-
read_delim("Results/Annotation_clean_names.txt") %>%
right_join(analytes_detected,
by = join_by("Average Rt(min)" == "RT",
"Average Mz" == "Mz"))
annotated_detected <- Annotation %>%
filter(Clean_name != "Unknown" &
!grepl("w/o MS2", Clean_name))
#### Venn plots ####
par(cex=1, font=1);
venn_detected <- analytes_detected %>%
select(all_of(clones))
pdf('plots/Venn_filteredMetaboanalyst_detected3reps.pdf',
width=8, height=8, pointsize = 30)
venn(venn_detected,
ilabels = "counts",
ellipse = T, box = F,
zcolor = "style",
par = T)
dev.off()
venn_annotated_detected <-
annotated_detected %>%
select(all_of(clones))
pdf('plots/Venn_filteredMetaboanalyst_annotatedDetected3reps.pdf',
width=8, height=8, pointsize = 30)
venn(venn_annotated_detected,
ilabels = "counts",
ellipse = T, box = F,
zcolor = "style",
par = T)
dev.off()
annotated_detected %>%
filter(!E30) %>%
select(Clean_name, INCHIKEY, all_of(clones)) %>%
write_delim(file = "Results/Annotated_notInE303reps.txt",
delim="\t")
View(annotated_detected)
View(Annotation)
View(venn_annotated_detected)
View(venn_detected)
View(analytes_detected)
View(annotated_detected)
analytes_detected <- sapply(1:length(Analysis_modes), simplify = F, \(i) {
file = inFiles[i]
output = outFiles[i]
load(mSetData[i])
featuresKept_metaboanalyst <-
mSet[["dataSet"]][["filt"]] %>% colnames
input = read_delim(file)
metadata = data.frame(Clone = input[1, -1] %>% unlist %>% unname ,
Replicate = names(input)[-1]) %>%
filter(Clone != "QC")
input_logical =
as.data.frame(input[-1,],
row.names = input[-1,1] %>% c)[-1] %>%
apply(MARGIN=2, \(x) as.numeric(x) %>% as.logical )
rownames(input_logical) = input$Sample[-1]
groups = unique(metadata$Clone)
sapply(groups, \(x) {
rowSums(input_logical[featuresKept_metaboanalyst,
metadata$Replicate[metadata$Clone == x]]) == 3
}) %>% colSums %>% print()
sapply(groups, \(x) {
rowSums(input_logical[featuresKept_metaboanalyst,
metadata$Replicate[metadata$Clone == x]]) == 3
}) %>% as.data.frame
}) %>% list_rbind() %>%
filter(rowSums(.) != 0) %>%
mutate(MetID = row.names(.)) %>%
separate(col = MetID, into = c("RT", "Mz"), sep = "/", convert = T)
sapply(groups, \(x) {
rowSums(input_logical[featuresKept_metaboanalyst,
metadata$Replicate[metadata$Clone == x]]) == 3
}) %>% as.data.frame
analytes_detected <- sapply(1:length(Analysis_modes), simplify = F, \(i) {
file = inFiles[i]
output = outFiles[i]
load(mSetData[i])
featuresKept_metaboanalyst <-
mSet[["dataSet"]][["filt"]] %>% colnames
input = read_delim(file)
metadata = data.frame(Clone = input[1, -1] %>% unlist %>% unname ,
Replicate = names(input)[-1]) %>%
filter(Clone != "QC")
input_logical =
as.data.frame(input[-1,],
row.names = input[-1,1] %>% c)[-1] %>%
apply(MARGIN=2, \(x) as.numeric(x) %>% as.logical )
rownames(input_logical) = input$Sample[-1]
groups = unique(metadata$Clone)
sapply(groups, \(x) {
rowSums(input_logical[featuresKept_metaboanalyst,
metadata$Replicate[metadata$Clone == x]]) == 2
}) %>% colSums %>% print()
sapply(groups, \(x) {
rowSums(input_logical[featuresKept_metaboanalyst,
metadata$Replicate[metadata$Clone == x]]) == 3
}) %>% as.data.frame
}) %>% list_rbind() %>%
filter(rowSums(.) != 0) %>%
mutate(MetID = row.names(.)) %>%
separate(col = MetID, into = c("RT", "Mz"), sep = "/", convert = T)
rowSums(input_logical[featuresKept_metaboanalyst,
metadata$Replicate[metadata$Clone == x]]) == 3
analytes_detected <- sapply(1:length(Analysis_modes), simplify = F, \(i) {
file = inFiles[i]
output = outFiles[i]
load(mSetData[i])
featuresKept_metaboanalyst <-
mSet[["dataSet"]][["filt"]] %>% colnames
input = read_delim(file)
metadata = data.frame(Clone = input[1, -1] %>% unlist %>% unname ,
Replicate = names(input)[-1]) %>%
filter(Clone != "QC")
input_logical =
as.data.frame(input[-1,],
row.names = input[-1,1] %>% c)[-1] %>%
apply(MARGIN=2, \(x) as.numeric(x) %>% as.logical )
rownames(input_logical) = input$Sample[-1]
groups = unique(metadata$Clone)
sapply(groups, \(x) {
rowSums(input_logical[featuresKept_metaboanalyst,
metadata$Replicate[metadata$Clone == x]]) == 3
}) %>% colSums %>% print()
sapply(groups, \(x) {
rowSums(input_logical[featuresKept_metaboanalyst,
metadata$Replicate[metadata$Clone == x]]) == 3
}) %>% as.data.frame
}) %>% list_rbind() %>%
filter(rowSums(.) != 0) %>%
mutate(MetID = row.names(.)) %>%
separate(col = MetID, into = c("RT", "Mz"), sep = "/", convert = T)
rowSums(input_logical[featuresKept_metaboanalyst,
metadata$Replicate[metadata$Clone == x]]) == 2
analytes_detected <- sapply(1:length(Analysis_modes), simplify = F, \(i) {
file = inFiles[i]
output = outFiles[i]
load(mSetData[i])
featuresKept_metaboanalyst <-
mSet[["dataSet"]][["filt"]] %>% colnames
input = read_delim(file)
metadata = data.frame(Clone = input[1, -1] %>% unlist %>% unname ,
Replicate = names(input)[-1]) %>%
filter(Clone != "QC")
input_logical =
as.data.frame(input[-1,],
row.names = input[-1,1] %>% c)[-1] %>%
apply(MARGIN=2, \(x) as.numeric(x) %>% as.logical )
rownames(input_logical) = input$Sample[-1]
groups = unique(metadata$Clone)
sapply(groups, \(x) {
rowSums(input_logical[featuresKept_metaboanalyst,
metadata$Replicate[metadata$Clone == x]]) == 2
}) %>% colSums %>% print()
sapply(groups, \(x) {
rowSums(input_logical[featuresKept_metaboanalyst,
metadata$Replicate[metadata$Clone == x]]) == 3
}) %>% as.data.frame
}) %>% list_rbind() %>%
filter(rowSums(.) != 0) %>%
mutate(MetID = row.names(.)) %>%
separate(col = MetID, into = c("RT", "Mz"), sep = "/", convert = T)
analytes_detected <- sapply(1:length(Analysis_modes), simplify = F, \(i) {
file = inFiles[i]
output = outFiles[i]
load(mSetData[i])
featuresKept_metaboanalyst <-
mSet[["dataSet"]][["filt"]] %>% colnames
input = read_delim(file)
metadata = data.frame(Clone = input[1, -1] %>% unlist %>% unname ,
Replicate = names(input)[-1]) %>%
filter(Clone != "QC")
input_logical =
as.data.frame(input[-1,],
row.names = input[-1,1] %>% c)[-1] %>%
apply(MARGIN=2, \(x) as.numeric(x) %>% as.logical )
rownames(input_logical) = input$Sample[-1]
groups = unique(metadata$Clone)
sapply(groups, \(x) {
rowSums(input_logical[featuresKept_metaboanalyst,
metadata$Replicate[metadata$Clone == x]]) %>% head %>% print()
})
sapply(groups, \(x) {
rowSums(input_logical[featuresKept_metaboanalyst,
metadata$Replicate[metadata$Clone == x]]) == 3
}) %>% as.data.frame
}) %>% list_rbind() %>%
filter(rowSums(.) != 0) %>%
mutate(MetID = row.names(.)) %>%
separate(col = MetID, into = c("RT", "Mz"), sep = "/", convert = T)
View(analytes_detected)
analytes_detected <- sapply(1:length(Analysis_modes), simplify = F, \(i) {
file = inFiles[i]
output = outFiles[i]
load(mSetData[i])
featuresKept_metaboanalyst <-
mSet[["dataSet"]][["filt"]] %>% colnames
input = read_delim(file)
metadata = data.frame(Clone = input[1, -1] %>% unlist %>% unname ,
Replicate = names(input)[-1]) %>%
filter(Clone != "QC")
input_logical =
as.data.frame(input[-1,],
row.names = input[-1,1] %>% c)[-1] %>%
apply(MARGIN=2, \(x) as.numeric(x) %>% as.logical )
rownames(input_logical) = input$Sample[-1]
groups = unique(metadata$Clone)
if ("4.951/301.21666" %in% featuresKept_metaboanalyst ) {
print(input[input[1,] == "4.951/301.21666",])
}
sapply(groups, \(x) {
rowSums(input_logical[featuresKept_metaboanalyst,
metadata$Replicate[metadata$Clone == x]]) == 3
}) %>% as.data.frame
}) %>% list_rbind() %>%
filter(rowSums(.) != 0) %>%
mutate(MetID = row.names(.)) %>%
separate(col = MetID, into = c("RT", "Mz"), sep = "/", convert = T)
analytes_detected <- sapply(1:length(Analysis_modes), simplify = F, \(i) {
file = inFiles[i]
output = outFiles[i]
load(mSetData[i])
featuresKept_metaboanalyst <-
mSet[["dataSet"]][["filt"]] %>% colnames
input = read_delim(file)
metadata = data.frame(Clone = input[1, -1] %>% unlist %>% unname ,
Replicate = names(input)[-1]) %>%
filter(Clone != "QC")
input_logical =
as.data.frame(input[-1,],
row.names = input[-1,1] %>% c)[-1] %>%
apply(MARGIN=2, \(x) as.numeric(x) %>% as.logical )
rownames(input_logical) = input$Sample[-1]
groups = unique(metadata$Clone)
if ("4.951/301.21666" %in% featuresKept_metaboanalyst ) {
print(input[input[[1]] == "4.951/301.21666",])
}
sapply(groups, \(x) {
rowSums(input_logical[featuresKept_metaboanalyst,
metadata$Replicate[metadata$Clone == x]]) == 3
}) %>% as.data.frame
}) %>% list_rbind() %>%
filter(rowSums(.) != 0) %>%
mutate(MetID = row.names(.)) %>%
separate(col = MetID, into = c("RT", "Mz"), sep = "/", convert = T)
analytes_detected <- sapply(1:length(Analysis_modes), simplify = F, \(i) {
file = inFiles[i]
output = outFiles[i]
load(mSetData[i])
featuresKept_metaboanalyst <-
mSet[["dataSet"]][["filt"]] %>% colnames
input = read_delim(file)
metadata = data.frame(Clone = input[1, -1] %>% unlist %>% unname ,
Replicate = names(input)[-1]) %>%
filter(Clone != "QC")
input_logical =
as.data.frame(input[-1,],
row.names = input[-1,1] %>% c)[-1] %>%
apply(MARGIN=2, \(x) as.numeric(x) %>% as.logical )
rownames(input_logical) = input$Sample[-1]
groups = unique(metadata$Clone)
if ("4.951/301.21666" %in% featuresKept_metaboanalyst ) {
View(input[input[[1]] == "4.951/301.21666",])
}
sapply(groups, \(x) {
rowSums(input_logical[featuresKept_metaboanalyst,
metadata$Replicate[metadata$Clone == x]]) == 3
}) %>% as.data.frame
}) %>% list_rbind() %>%
filter(rowSums(.) != 0) %>%
mutate(MetID = row.names(.)) %>%
separate(col = MetID, into = c("RT", "Mz"), sep = "/", convert = T)
analytes_detected <- sapply(1:length(Analysis_modes), simplify = F, \(i) {
file = inFiles[i]
output = outFiles[i]
load(mSetData[i])
featuresKept_metaboanalyst <-
mSet[["dataSet"]][["filt"]] %>% colnames
input = read_delim(file)
metadata = data.frame(Clone = input[1, -1] %>% unlist %>% unname ,
Replicate = names(input)[-1]) %>%
filter(Clone != "QC")
input_logical =
as.data.frame(input[-1,],
row.names = input[-1,1] %>% c)[-1] %>%
apply(MARGIN=2, \(x) as.numeric(x) %>% as.logical )
rownames(input_logical) = input$Sample[-1]
groups = unique(metadata$Clone)
if ("4.951/301.21666" %in% featuresKept_metaboanalyst ) {
View(input_logical[rownames(input_logical) == "4.951/301.21666",])
}
sapply(groups, \(x) {
rowSums(input_logical[featuresKept_metaboanalyst,
metadata$Replicate[metadata$Clone == x]]) == 3
}) %>% as.data.frame
}) %>% list_rbind() %>%
filter(rowSums(.) != 0) %>%
mutate(MetID = row.names(.)) %>%
separate(col = MetID, into = c("RT", "Mz"), sep = "/", convert = T)
analytes_detected <- sapply(1:length(Analysis_modes), simplify = F, \(i) {
file = inFiles[i]
output = outFiles[i]
load(mSetData[i])
featuresKept_metaboanalyst <-
mSet[["dataSet"]][["filt"]] %>% colnames
input = read_delim(file)
metadata = data.frame(Clone = input[1, -1] %>% unlist %>% unname ,
Replicate = names(input)[-1]) %>%
filter(Clone != "QC")
input_logical =
as.data.frame(input[-1,],
row.names = input[-1,1] %>% c)[-1] %>%
apply(MARGIN=2, \(x) as.numeric(x) %>% as.logical )
rownames(input_logical) = input$Sample[-1]
groups = unique(metadata$Clone)
if ("4.951/301.21666" %in% featuresKept_metaboanalyst ) {
View(input_logical[rownames(input_logical) == "4.951/301.21666",])
}
sapply(groups, \(x) {
rowSums(input_logical[featuresKept_metaboanalyst,
metadata$Replicate[metadata$Clone == x]]) >= 2
}) %>% as.data.frame
}) %>% list_rbind() %>%
filter(rowSums(.) != 0) %>%
mutate(MetID = row.names(.)) %>%
separate(col = MetID, into = c("RT", "Mz"), sep = "/", convert = T)
View(analytes_detected)
par(cex=1, font=1);
venn_detected <- analytes_detected %>%
select(all_of(clones))
pdf('plots/Venn_filteredMetaboanalyst_detected.pdf',
width=8, height=8, pointsize = 30)
venn(venn_detected,
ilabels = "counts",
ellipse = T, box = F,
zcolor = "style",
par = T)
dev.off()
venn_annotated_detected <-
annotated_detected %>%
select(all_of(clones))
pdf('plots/Venn_filteredMetaboanalyst_annotatedDetected.pdf',
width=8, height=8, pointsize = 30)
venn(venn_annotated_detected,
ilabels = "counts",
ellipse = T, box = F,
zcolor = "style",
par = T)
dev.off()
annotated_detected %>%
filter(!E30) %>%
select(Clean_name, INCHIKEY, all_of(clones)) %>%
write_delim(file = "Results/Annotated_notInE30.txt",
delim="\t")
Annotation <-
read_delim("Results/Annotation_clean_names.txt") %>%
right_join(analytes_detected,
by = join_by("Average Rt(min)" == "RT",
"Average Mz" == "Mz"))
annotated_detected <- Annotation %>%
filter(Clean_name != "Unknown" &
!grepl("w/o MS2", Clean_name))
#### Venn plots ####
par(cex=1, font=1);
venn_detected <- analytes_detected %>%
select(all_of(clones))
pdf('plots/Venn_filteredMetaboanalyst_detected.pdf',
width=8, height=8, pointsize = 30)
venn(venn_detected,
ilabels = "counts",
ellipse = T, box = F,
zcolor = "style",
par = T)
dev.off()
venn_annotated_detected <-
annotated_detected %>%
select(all_of(clones))
pdf('plots/Venn_filteredMetaboanalyst_annotatedDetected.pdf',
width=8, height=8, pointsize = 30)
venn(venn_annotated_detected,
ilabels = "counts",
ellipse = T, box = F,
zcolor = "style",
par = T)
dev.off()
annotated_detected %>%
filter(!E30) %>%
select(Clean_name, INCHIKEY, all_of(clones)) %>%
write_delim(file = "Results/Annotated_notInE30.txt",
delim="\t")
View(annotated_detected)
annotated_detected %>%
filter(!E30) %>%
select(Clean_name, INCHIKEY, all_of(clones))
featuresKept_metaboanalyst <- sapply(mSetData, \(x) {
load(mSetData[i])
featuresKept_metaboanalyst <-
mSet[["dataSet"]][["filt"]] %>% colnames
}) %>% unlist %>% unname %>% c
featuresKept_metaboanalyst <- sapply(mSetData, \(x) {
load(mSetData[x])
featuresKept_metaboanalyst <-
mSet[["dataSet"]][["filt"]] %>% colnames
}) %>% unlist %>% unname %>% c
mSetData <- paste0("Results/", Analysis_modes, "_mSet.RData")
featuresKept_metaboanalyst <- sapply(mSetData, \(x) {
load(mSetData[x])
featuresKept_metaboanalyst <-
mSet[["dataSet"]][["filt"]] %>% colnames
}) %>% unlist %>% unname %>% c
mSetData <- paste0("Results/", Analysis_modes, "_mSet.RData")
# Mets present in each clone
library(tidyverse)
library(MetaboAnalystR)
library(venn)
clones <- c(paste0("AC9.", 1:3), "E30")
Analysis_modes = c("HILIC_Positive",
"RP_Positive",
"RP_Negative")
inFiles <- paste0("Inputs/CleanUp_LCMSMS_", Analysis_modes, "_rawHeight.txt")
outFiles <- paste0("Results/Analytes_detected_by_clone_", Analysis_modes, ".txt")
mSetData <- paste0("Results/", Analysis_modes, "_mSet.RData")
featuresKept_metaboanalyst <- sapply(mSetData, \(x) {
load(mSetData[x])
featuresKept_metaboanalyst <-
mSet[["dataSet"]][["filt"]] %>% colnames
}) %>% unlist %>% unname %>% c
featuresKept_metaboanalyst <- sapply(mSetData, \(x) {
load(mSetData[x])
})    featuresKept_metaboanalyst <-
featuresKept_metaboanalyst <- sapply(mSetData, \(x) {
load(mSetData[x])
})
mSetData <- paste0("Results/", Analysis_modes, "_mSet.RData")
mSetData
load("Results/HILIC_Positive_mSet.RData")
featuresKept_metaboanalyst <- sapply(mSetData, \(x) {
load(x)
mSet[["dataSet"]][["filt"]] %>% colnames
})
featuresKept_metaboanalyst <- sapply(mSetData, \(x) {
load(x)
mSet[["dataSet"]][["filt"]] %>% colnames
})%>% unlist %>% unname %>% c
input = sapply(1:length(Analysis_modes), simplify = F, \(i) {
read_delim(inFiles[i])[-1]
}) %>% list_rbind()
View(input)
input = sapply(1:length(Analysis_modes), simplify = F, \(i) {
read_delim(inFiles[i])[-1,]
}) %>% list_rbind()
clones <- c(paste0("AC9.", 1:3), "pPTGE30")
