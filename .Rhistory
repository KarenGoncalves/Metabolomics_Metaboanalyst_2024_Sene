geom_tile() +
scale_fill_gradientn(values = color_scale,
name = "Fold change",
limits = range(color_scale),
breaks = color_scale) +
labs(x = "", y="", fill="Fold Change") +
theme_classic() +
theme(legend.position = "bottom",
axis.text.x = element_text(angle=45, hjust=1, vjust=1),
axis.text.y = element_text(size=7),
legend.key.size = unit(1, "cm")
#axis.ticks.x = element_blank()
)
heatmap_data %>%
mutate(ordered_mets = Metabolite_nameUnique %>%
factor(levels = order_mets$labels[order_mets$order]),
Contrast_ordered = plotContrast %>%
factor(levels = sapply(1:6, \(x) paste(tableContrast$Numerator[x], "vs",
tableContrast$Denominator[x]))
)
) %>%
ggplot(aes(y=ordered_mets, x = Contrast_ordered, fill = FoldChange)) +
geom_tile() +
scale_fill_gradientn(colors = color_scale,
values = color_scale,
name = "Fold change",
limits = range(color_scale),
breaks = color_scale) +
labs(x = "", y="", fill="Fold Change") +
theme_classic() +
theme(legend.position = "bottom",
axis.text.x = element_text(angle=45, hjust=1, vjust=1),
axis.text.y = element_text(size=7),
legend.key.size = unit(1, "cm")
#axis.ticks.x = element_blank()
)
heatmap_data %>%
mutate(ordered_mets = Metabolite_nameUnique %>%
factor(levels = order_mets$labels[order_mets$order]),
Contrast_ordered = plotContrast %>%
factor(levels = sapply(1:6, \(x) paste(tableContrast$Numerator[x], "vs",
tableContrast$Denominator[x]))
)
) %>%
ggplot(aes(y=ordered_mets, x = Contrast_ordered, fill = FoldChange)) +
geom_tile() +
scale_fill_gradientn(colors = color_scale,
#values = color_scale,
name = "Fold change",
limits = range(color_scale),
breaks = color_scale) +
labs(x = "", y="", fill="Fold Change") +
theme_classic() +
theme(legend.position = "bottom",
axis.text.x = element_text(angle=45, hjust=1, vjust=1),
axis.text.y = element_text(size=7),
legend.key.size = unit(1, "cm")
#axis.ticks.x = element_blank()
)
color_scale
heatmap_data %>%
mutate(ordered_mets = Metabolite_nameUnique %>%
factor(levels = order_mets$labels[order_mets$order]),
Contrast_ordered = plotContrast %>%
factor(levels = sapply(1:6, \(x) paste(tableContrast$Numerator[x], "vs",
tableContrast$Denominator[x]))
)
) %>%
ggplot(aes(y=ordered_mets, x = Contrast_ordered, fill = FoldChange)) +
geom_tile() +
scale_fill_gradientn(colors = color_scale,
#values = color_scale,
name = "Fold change",
limits = range(color_scale),
breaks = color_scale) +
labs(x = "", y="", fill="Fold Change") +
theme_classic() +
theme(legend.position = "bottom",
axis.text.x = element_text(angle=45, hjust=1, vjust=1),
axis.text.y = element_text(size=7),
legend.key.size = unit(1, "cm")
#axis.ticks.x = element_blank()
)
traceback()
heatmap_data %>%
mutate(ordered_mets = Metabolite_nameUnique %>%
factor(levels = order_mets$labels[order_mets$order]),
Contrast_ordered = plotContrast %>%
factor(levels = sapply(1:6, \(x) paste(tableContrast$Numerator[x], "vs",
tableContrast$Denominator[x]))
)
) %>%
ggplot(aes(y=ordered_mets, x = Contrast_ordered, fill = FoldChange)) +
geom_tile() +
scale_fill_gradientn(#colors = color_scale,
values = color_scale,
name = "Fold change",
limits = range(color_scale),
breaks = color_scale) +
labs(x = "", y="", fill="Fold Change") +
theme_classic() +
theme(legend.position = "bottom",
axis.text.x = element_text(angle=45, hjust=1, vjust=1),
axis.text.y = element_text(size=7),
legend.key.size = unit(1, "cm")
#axis.ticks.x = element_blank()
)
heatmap_data %>%
mutate(ordered_mets = Metabolite_nameUnique %>%
factor(levels = order_mets$labels[order_mets$order]),
Contrast_ordered = plotContrast %>%
factor(levels = sapply(1:6, \(x) paste(tableContrast$Numerator[x], "vs",
tableContrast$Denominator[x]))
)
) %>%
ggplot(aes(y=ordered_mets, x = Contrast_ordered, fill = FoldChange)) +
geom_tile() +
scale_fill_gradientn(colors = unname(color_scale),
#values = color_scale,
name = "Fold change",
limits = range(color_scale),
breaks = color_scale) +
labs(x = "", y="", fill="Fold Change") +
theme_classic() +
theme(legend.position = "bottom",
axis.text.x = element_text(angle=45, hjust=1, vjust=1),
axis.text.y = element_text(size=7),
legend.key.size = unit(1, "cm")
#axis.ticks.x = element_blank()
)
color_scale
heatmap_data %>%
mutate(ordered_mets = Metabolite_nameUnique %>%
factor(levels = order_mets$labels[order_mets$order]),
Contrast_ordered = plotContrast %>%
factor(levels = sapply(1:6, \(x) paste(tableContrast$Numerator[x], "vs",
tableContrast$Denominator[x]))
)
) %>%
ggplot(aes(y=ordered_mets, x = Contrast_ordered, fill = FoldChange)) +
geom_tile() +
scale_fill_gradientn(colors = unname(color_scale),
#values = color_scale,
name = "Fold change",
limits = range(color_scale),
breaks = names(color_scale)) +
labs(x = "", y="", fill="Fold Change") +
theme_classic() +
theme(legend.position = "bottom",
axis.text.x = element_text(angle=45, hjust=1, vjust=1),
axis.text.y = element_text(size=7),
legend.key.size = unit(1, "cm")
#axis.ticks.x = element_blank()
)
heatmap_data %>%
mutate(ordered_mets = Metabolite_nameUnique %>%
factor(levels = order_mets$labels[order_mets$order]),
Contrast_ordered = plotContrast %>%
factor(levels = sapply(1:6, \(x) paste(tableContrast$Numerator[x], "vs",
tableContrast$Denominator[x]))
)
) %>%
ggplot(aes(y=ordered_mets, x = Contrast_ordered, fill = FoldChange)) +
geom_tile() +
scale_fill_gradientn(colors = color_scale,
#values = color_scale,
name = "Fold change",
limits = range(color_scale),
breaks = names(color_scale)) +
labs(x = "", y="", fill="Fold Change") +
theme_classic() +
theme(legend.position = "bottom",
axis.text.x = element_text(angle=45, hjust=1, vjust=1),
axis.text.y = element_text(size=7),
legend.key.size = unit(1, "cm")
#axis.ticks.x = element_blank()
)
color_scale = rev(brewer.pal(7, "RdBu"))
names(color_scale) =
c(-color_limit, -color_limit/2, -FC_threshold,
0, FC_threshold, color_limit/2, color_limit)
color_scale
heatmap_data %>%
mutate(ordered_mets = Metabolite_nameUnique %>%
factor(levels = order_mets$labels[order_mets$order]),
Contrast_ordered = plotContrast %>%
factor(levels = sapply(1:6, \(x) paste(tableContrast$Numerator[x], "vs",
tableContrast$Denominator[x]))
)
) %>%
ggplot(aes(y=ordered_mets, x = Contrast_ordered, fill = FoldChange)) +
geom_tile() +
scale_fill_gradientn(colors = color_scale,
#values = color_scale,
name = "Fold change",
limits = range(color_scale),
breaks = names(color_scale)) +
labs(x = "", y="", fill="Fold Change") +
theme_classic() +
theme(legend.position = "bottom",
axis.text.x = element_text(angle=45, hjust=1, vjust=1),
axis.text.y = element_text(size=7),
legend.key.size = unit(1, "cm")
#axis.ticks.x = element_blank()
)
heatmap_data %>%
mutate(ordered_mets = Metabolite_nameUnique %>%
factor(levels = order_mets$labels[order_mets$order]),
Contrast_ordered = plotContrast %>%
factor(levels = sapply(1:6, \(x) paste(tableContrast$Numerator[x], "vs",
tableContrast$Denominator[x]))
)
) %>%
ggplot(aes(y=ordered_mets, x = Contrast_ordered, fill = FoldChange)) +
geom_tile() +
scale_fill_gradientn(colors = rev(brewer.pal(5, "RdBu")),
name = "Fold change",
limits = range(color_scale),
breaks = color_scale,
labels = color_scale) +
labs(x = "", y="", fill="Fold Change") +
theme_classic() +
theme(legend.position = "bottom",
axis.text.x = element_text(angle=45, hjust=1, vjust=1),
axis.text.y = element_text(size=7),
legend.key.size = unit(1, "cm")
#axis.ticks.x = element_blank()
)
color_scale = c(-color_limit, -color_limit/2, -FC_threshold,
0, FC_threshold, color_limit/2, color_limit)
heatmap_data %>%
mutate(ordered_mets = Metabolite_nameUnique %>%
factor(levels = order_mets$labels[order_mets$order]),
Contrast_ordered = plotContrast %>%
factor(levels = sapply(1:6, \(x) paste(tableContrast$Numerator[x], "vs",
tableContrast$Denominator[x]))
)
) %>%
ggplot(aes(y=ordered_mets, x = Contrast_ordered, fill = FoldChange)) +
geom_tile() +
scale_fill_gradientn(colors = rev(brewer.pal(5, "RdBu")),
name = "Fold change",
limits = range(color_scale),
breaks = color_scale,
labels = color_scale) +
labs(x = "", y="", fill="Fold Change") +
theme_classic() +
theme(legend.position = "bottom",
axis.text.x = element_text(angle=45, hjust=1, vjust=1),
axis.text.y = element_text(size=7),
legend.key.size = unit(1, "cm")
#axis.ticks.x = element_blank()
)
heatmap_data %>%
mutate(ordered_mets = Metabolite_nameUnique %>%
factor(levels = order_mets$labels[order_mets$order]),
Contrast_ordered = plotContrast %>%
factor(levels = sapply(1:6, \(x) paste(tableContrast$Numerator[x], "vs",
tableContrast$Denominator[x]))
)
) %>%
ggplot(aes(y=ordered_mets, x = Contrast_ordered, fill = FoldChange)) +
geom_tile() +
scale_fill_gradientn(colors = rev(brewer.pal(7, "RdBu")),
name = "Fold change",
limits = range(color_scale),
breaks = color_scale,
labels = color_scale) +
labs(x = "", y="", fill="Fold Change") +
theme_classic() +
theme(legend.position = "bottom",
axis.text.x = element_text(angle=45, hjust=1, vjust=1),
axis.text.y = element_text(size=7),
legend.key.size = unit(1, "cm")
#axis.ticks.x = element_blank()
)
names(colors) = color_scale
colors = rev(brewer.pal(7, "RdBu"))
names(colors) = color_scale
heatmap_data %>%
mutate(ordered_mets = Metabolite_nameUnique %>%
factor(levels = order_mets$labels[order_mets$order]),
Contrast_ordered = plotContrast %>%
factor(levels = sapply(1:6, \(x) paste(tableContrast$Numerator[x], "vs",
tableContrast$Denominator[x]))
)
) %>%
ggplot(aes(y=ordered_mets, x = Contrast_ordered, fill = FoldChange)) +
geom_tile() +
scale_fill_gradientn(colors = rev(brewer.pal(7, "RdBu")),
name = "Fold change",
limits = range(color_scale),
breaks = color_scale,
labels = color_scale) +
labs(x = "", y="", fill="Fold Change") +
theme_classic() +
theme(legend.position = "bottom",
axis.text.x = element_text(angle=45, hjust=1, vjust=1),
axis.text.y = element_text(size=7),
legend.key.size = unit(1, "cm")
#axis.ticks.x = element_blank()
)
colors[c(-FC_threshold, "0", FC_threshold)] = "white"
colors
heatmap_data %>%
mutate(ordered_mets = Metabolite_nameUnique %>%
factor(levels = order_mets$labels[order_mets$order]),
Contrast_ordered = plotContrast %>%
factor(levels = sapply(1:6, \(x) paste(tableContrast$Numerator[x], "vs",
tableContrast$Denominator[x]))
)
) %>%
ggplot(aes(y=ordered_mets, x = Contrast_ordered, fill = FoldChange)) +
geom_tile() +
scale_fill_gradientn(colors = rev(brewer.pal(7, "RdBu")),
name = "Fold change",
limits = range(color_scale),
breaks = color_scale,
labels = color_scale) +
labs(x = "", y="", fill="Fold Change") +
theme_classic() +
theme(legend.position = "bottom",
axis.text.x = element_text(angle=45, hjust=1, vjust=1),
axis.text.y = element_text(size=7),
legend.key.size = unit(1, "cm")
#axis.ticks.x = element_blank()
)
heatmap_data %>%
mutate(ordered_mets = Metabolite_nameUnique %>%
factor(levels = order_mets$labels[order_mets$order]),
Contrast_ordered = plotContrast %>%
factor(levels = sapply(1:6, \(x) paste(tableContrast$Numerator[x], "vs",
tableContrast$Denominator[x]))
)
) %>%
ggplot(aes(y=ordered_mets, x = Contrast_ordered, fill = FoldChange)) +
geom_tile() +
scale_fill_gradientn(colors = colors,
name = "Fold change",
limits = range(color_scale),
breaks = color_scale,
labels = color_scale) +
labs(x = "", y="", fill="Fold Change") +
theme_classic() +
theme(legend.position = "bottom",
axis.text.x = element_text(angle=45, hjust=1, vjust=1),
axis.text.y = element_text(size=7),
legend.key.size = unit(1, "cm")
#axis.ticks.x = element_blank()
)
heatmap_data %>%
mutate(ordered_mets = Metabolite_nameUnique %>%
factor(levels = order_mets$labels[order_mets$order]),
Contrast_ordered = plotContrast %>%
factor(levels = sapply(1:6, \(x) paste(tableContrast$Numerator[x], "vs",
tableContrast$Denominator[x]))
)
) %>%
ggplot(aes(y=ordered_mets, x = Contrast_ordered, fill = FoldChange)) +
geom_tile() +
scale_fill_gradientn(colors = colors,
name = "Fold change",
limits = range(color_scale),
breaks = color_scale,
labels = color_scale) +
labs(x = "", y="", fill="Fold Change") +
theme_classic() +
theme(legend.position = "bottom",
axis.text.x = element_text(angle=45, hjust=1, vjust=1),
axis.text.y = element_text(size=7),
legend.key.height = unit(1, "mm"),
legend.key.width = unit(1, "cm"),
#axis.ticks.x = element_blank()
)
heatmap_data %>%
mutate(ordered_mets = Metabolite_nameUnique %>%
factor(levels = order_mets$labels[order_mets$order]),
Contrast_ordered = plotContrast %>%
factor(levels = sapply(1:6, \(x) paste(tableContrast$Numerator[x], "vs",
tableContrast$Denominator[x]))
)
) %>%
ggplot(aes(y=ordered_mets, x = Contrast_ordered, fill = FoldChange)) +
geom_tile() +
scale_fill_gradientn(colors = colors,
name = "Fold change",
limits = range(color_scale),
breaks = color_scale,
labels = color_scale) +
labs(x = "", y="", fill="Fold Change") +
theme_classic() +
theme(legend.position = "bottom",
axis.text.x = element_text(angle=45, hjust=1, vjust=1),
axis.text.y = element_text(size=7),
legend.key.height = unit(5, "mm"),
legend.key.width = unit(1, "cm"),
#axis.ticks.x = element_blank()
)
heatmap_data %>%
mutate(ordered_mets = Metabolite_nameUnique %>%
factor(levels = order_mets$labels[order_mets$order]),
Contrast_ordered = plotContrast %>%
factor(levels = sapply(1:6, \(x) paste(tableContrast$Numerator[x], "vs",
tableContrast$Denominator[x]))
)
) %>%
ggplot(aes(y=ordered_mets, x = Contrast_ordered, fill = FoldChange)) +
geom_tile() +
scale_fill_gradientn(colors = colors,
name = "Fold change",
limits = range(color_scale),
breaks = color_scale,
labels = color_scale) +
labs(x = "", y="", fill="Fold Change") +
theme_classic() +
theme(legend.position = "bottom",
axis.text.x = element_text(angle=45, hjust=1, vjust=1),
axis.text.y = element_text(size=7),
legend.key.height = unit(10, "mm"),
legend.key.width = unit(1, "cm"),
#axis.ticks.x = element_blank()
)
heatmap_data %>%
mutate(ordered_mets = Metabolite_nameUnique %>%
factor(levels = order_mets$labels[order_mets$order]),
Contrast_ordered = plotContrast %>%
factor(levels = sapply(1:6, \(x) paste(tableContrast$Numerator[x], "vs",
tableContrast$Denominator[x]))
)
) %>%
ggplot(aes(y=ordered_mets, x = Contrast_ordered, fill = FoldChange)) +
geom_tile() +
scale_fill_gradientn(colors = colors,
name = "Fold change",
limits = range(color_scale),
breaks = color_scale,
labels = color_scale) +
labs(x = "", y="", fill="Fold Change") +
theme_classic() +
theme(legend.position = "bottom",
axis.text.x = element_text(angle=45, hjust=1, vjust=1),
axis.text.y = element_text(size=7),
legend.key.height = unit(5, "mm"),
legend.key.width = unit(1, "cm"),
#axis.ticks.x = element_blank()
)
ggsave("plots/Annotated_heatmap_allModes.pdf",
height=8, width=7, dpi=1200)
#### Plot proportion of annotated DAAs ####
annotation_DAAs %>%
mutate(Annotated = factor(ifelse(`Metabolite name` != "Unknown",
"Yes", "No"),
levels = c("Yes", "No")
)
) %>%
group_by(Annotated, AnalysisMode) %>%
summarize(Analytes = length(`Metabolite name`)) %>%
group_by(AnalysisMode) %>%
summarize(Analytes = Analytes,
Annotated = Annotated,
Total = sum(Analytes)) %>%
mutate(Proportion = Analytes / Total,
Mode =
case_when(AnalysisMode == "HILIC_Positive" ~ "HILIC\nPositive",
AnalysisMode == "RP_Positive" ~ "Reversed phase\nPositive",
.default = "Reversed phase\nNegative")) %>%
ggplot(aes(x = "", Proportion, fill=Annotated,
label = Analytes)) +
geom_col() +
geom_text_repel(aes(color = Annotated),
show.legend = F) +
facet_grid(~Mode, scales = "free_y") +
coord_polar(theta = "y", start = 0) +
scale_fill_manual(values = c("No" = "grey", "Yes" = "red")
) +
scale_color_manual(values = c("No" = "grey30", "Yes" = "red")
) +
theme_void() +
theme(legend.position = "bottom")
#### Plot proportion of annotated DAAs ####
annotation_DAAs %>%
mutate(Annotated = factor(ifelse(`Metabolite name` != "Unknown",
"Yes", "No"),
levels = c("Yes", "No")
)
) %>%
group_by(Annotated, AnalysisMode) %>%
summarize(Analytes = length(`Metabolite name`)) %>%
group_by(AnalysisMode) %>%
summarize(Analytes = Analytes,
Annotated = Annotated,
Total = sum(Analytes)) %>%
mutate(Proportion = Analytes / Total,
Mode =
case_when(AnalysisMode == "HILIC_Positive" ~ "HILIC\nPositive",
AnalysisMode == "RP_Positive" ~ "Reversed phase\nPositive",
.default = "Reversed phase\nNegative")) %>%
ggplot(aes(x = "", Proportion, fill=Annotated,
label = Analytes)) +
geom_col() +
geom_text_repel(aes(color = Annotated),
show.legend = F) +
facet_grid(~Mode, scales = "free_y") +
coord_polar(theta = "y", start = 0) +
scale_fill_manual(values = c("No" = "grey", "Yes" = "red")
) +
scale_color_manual(values = c("No" = "grey20", "Yes" = "red")
) +
theme_void() +
theme(legend.position = "bottom")
ggsave("plots/Proportion_annotated_DAAs.pdf",
height=2.5, width=5, dpi=1200)
